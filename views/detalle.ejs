<%- include('partials/head') %>

<main>
  <section>
    <div class="hero-bg">
      <div class="container mx-auto px-4 lg:px-6 py-10 text-center text-white">
        <h1 class="text-4xl md:text-6xl font-extrabold mb-4 leading-tight">Resultados de la semana.</h1>
        <p class="text-lg md:text-xl text-gray-300 max-w-3xl mx-auto mb-8">
           Información disponible.
        </p>
      </div>
    </div>
      
    <!-- container -->
    <div class="container mx-auto px-4 lg:px-6 py-12">
      <% const fechas = Object.keys(agrupadosPorDia).sort(); %>
      <% if (fechas.length === 0) { %>
      <!-- Mensaje si no hay semanas -->
      <div class="bg-yellow-500/10 border border-yellow-500/30 text-yellow-300 p-4 rounded-lg flex items-center">
        <i data-lucide="alert-triangle" class="w-6 h-6 mr-3 flex-shrink-0"></i>
        <div>No hay partidos disponibles para mostrar en este momento.</div>
      </div>
      <% } %>
      
      <% fechas.forEach(fecha => { %>
      <div class="card rounded-xl overflow-hidden mb-8 max-w-3xl mx-auto">
        <!-- Header del Día -->
        <div class="p-4 bg-gray-800 border-b border-gray-700">
          <h4 class="text-xl font-bold text-white flex items-center">
            <i data-lucide="calendar" class="w-5 h-5 mr-3 text-emerald-400"></i>
            Día: <%= fecha %>
          </h4>
        </div>
        
        <!-- Lista de Partidos del Día -->
        <div class="p-4 md:p-6">
          <div class="divide-y divide-gray-700/50">
            <% agrupadosPorDia[fecha].forEach((partido, index) => { %>
            <% const isOptional = !partido.odds && partido.options; %>
            
            <div class="py-4">
              <div class="flex justify-between items-start">
                <strong class="text-base md:text-lg text-white"><%= partido.homeTeam?.name %> vs <%= partido.awayTeam?.name %></strong>
                <% if (isOptional) { %>
                <span class="text-xs font-bold px-2 py-1 rounded-full bg-yellow-500/20 text-yellow-400 ml-2 flex-shrink-0">Extra</span>
                <% } %>
              </div>
              
              <div class="text-sm text-gray-400 mt-2 pl-1">
                <% if (partido.finished) { %>
                  <% if (partido.odds) { %>
                    <div>Resultado: <span class="font-semibold text-gray-300"><%= partido.score %></span></div>
                    <div>Ganador: <span class="font-semibold text-gray-300"><%= partido.winner %></span></div>
                    <div>Cuota: <span class="font-bold text-emerald-400"><%= partido.odds[partido.winner] %></span></div>
                  <% } else if (partido.options) { %>
                    <% const optionKey = Object.keys(partido.options)[0]; %>
                    <div>Opción: <span class="font-semibold text-gray-300"><%= partido.options[optionKey].name %> Primer tiempo</span></div>
                    <div>Resultado: <span class="font-semibold text-gray-300"><%= partido.firstHalf %></span></div>
                    <div>Cuota: <span class="font-bold text-emerald-400"><%= partido.options[optionKey].odd %></span></div>
                  <% } %>
                <% } else { %>
                  <div class="flex items-center">
                    <i data-lucide="clock" class="w-4 h-4 mr-2"></i> Partido pendiente
                  </div>
                <% } %>
              </div>
            </div>
            <% }) %>
          </div>
          
          <!-- Resumen del Día -->
          <% 
            let alertBgClass = 'bg-yellow-500/10 border-yellow-500/30 text-yellow-300';
            let badgeBgClass = '';
            if (resultadosDias[fecha] === 'Ganadora') {
              alertBgClass = 'bg-emerald-500/10 border-emerald-500/30 text-emerald-300';
              badgeBgClass = 'bg-emerald-500/20 text-emerald-300';
            } else if (resultadosDias[fecha] === 'Perdida') {
              alertBgClass = 'bg-red-500/10 border-red-500/30 text-red-300';
              badgeBgClass = 'bg-red-500/20 text-red-300';
            }
          %>
          <div class="p-4 rounded-lg mt-4 flex flex-col sm:flex-row justify-between items-center <%= alertBgClass %> border">
            <% if (cuotasDiarias[fecha]) { %>
              <div class="font-semibold mb-2 sm:mb-0">
                Cuota acumulada del día: <strong class="text-xl text-white"><%= cuotasDiarias[fecha] %></strong>
              </div>
              <% if (resultadosDias[fecha] !== 'Pendiente') { %>
                <span class="text-sm font-bold px-3 py-1 rounded-full <%= badgeBgClass %>">
                  <%= resultadosDias[fecha] %>
                </span>
              <% } %>
            <% } else { %>
              <span>Cuota no disponible (partidos pendientes)</span>
            <% } %>
          </div>
        </div>
      </div>
      <% }) %>
      
      <!-- Resumen Semanal -->
      <div class="card mt-12 max-w-md mx-auto text-center">
        <div class="p-6">
          <h4 class="text-lg font-semibold text-gray-300 mb-2">Cuota Acumulada Semanal</h4>
          <h2 class="text-5xl font-extrabold text-emerald-400 tracking-tight">
            <%= cuotaTotalSemana %>
          </h2>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- Footer -->
<%- include('partials/footer') %>